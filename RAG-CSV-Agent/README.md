# CSV分割ツール & LLM分析

このアプリケーションは、CSVファイルを指定した行数（デフォルト: 20行）ごとのチャンクに分割し、OpenAI GPTモデルとGoogle Gemini AIを使用して分析を行うStreamlitベースのツールです。

## 機能

- CSVファイルのアップロード
- 自動的に20行ごとのチャンクに分割（分割サイズはカスタマイズ可能）
- 分割サイズによるチャンク数の自動計算（例: 700行の場合は35チャンク）
- 各チャンクのプレビュー表示
- すべての分割ファイルには全ての列とコラム名（ヘッダー）が含まれる
- 全チャンクをZIPファイルとしてダウンロード
- **OpenAI LLM分析**: 並列処理による個別チャンク分析
  - 売上Top順テーブル生成（商品名、型番、値段のみ表示）
  - 販売分析レポート生成（全ての列を分析に考慮、テーブル表示は重要な3列のみ）
- **Gemini Flash Thinking**: 複数チャンクの分析結果を統合した総括分析
  - チャンク別分析結果の統合
  - 全体的なトレンドと洞察の導出
  - 包括的な最終分析レポートの生成

## 使い方

1. 以下のコマンドでアプリケーションをインストールして実行します：

```bash
# 必要なパッケージをインストール
pip install -r requirements.txt

# アプリケーションを実行
streamlit run app.py
```

2. ブラウザが自動的に開き、アプリケーションが表示されます
3. 必要に応じて、サイドバーでチャンクサイズ（分割する行数）を調整できます
4. サイドバーでOpenAI APIキーとGemini APIキーを設定します
5. 「CSVファイルをアップロードしてください」ボタンをクリックしてCSVファイルを選択
6. アップロードが完了すると、アプリケーションが自動的にファイルを指定した行数ごとのチャンクに分割します
   - 700行のファイルを20行ずつ分割する場合、35個のチャンクが作成されます
7. 各チャンクの情報が表示され、ドロップダウンメニューからチャンクを選択してプレビューできます
8. 「ダウンロード: 分割されたCSVファイル」リンクをクリックすると、全チャンクをZIPファイルとしてダウンロードできます
9. ダウンロードされた各CSVファイルには全ての列とコラム名（ヘッダー）が保持されています

### LLM分析の使用方法

1. アプリケーション下部の「OpenAI LLM分析」セクションで分析タイプを選択します
   - 売上Top順テーブル: 売上データに基づいてランキングを生成（テーブルには商品名、型番、値段のみ表示）
   - 販売分析レポート: 詳細な販売分析レポートを生成（全ての列を分析に考慮するが、テーブル表示は重要な3列のみ）
2. 分析に使用するチャンク数を選択（処理時間とコストを考慮）
3. 「LLM分析を実行」ボタンをクリックして分析を開始
4. 分析結果はタブ形式で表示され、各チャンクごとの結果を確認できます
5. すべてのチャンクの分析結果一覧も確認できます
6. 最後に、**Gemini Flash Thinkingによる総括分析**が自動的に実行され、すべてのチャンク分析結果を統合した包括的な最終レポートが表示されます

## テーブル表示について

分析結果のテーブルには、以下の3つの列のみが表示されます：
- 商品名：製品名や品目名など、商品を識別する情報
- 型番：製品コードや商品IDなどの識別子
- 値段：価格や売上金額など

これにより、最も重要な情報に焦点を当てた見やすい分析結果が得られます。ただし、分析自体はCSVファイルの全ての列のデータを考慮して行われます。

## Gemini総括分析について

Gemini Flash Thinkingモデルを使用した総括分析では、OpenAIが生成した各チャンクの分析結果を統合し、より包括的かつ洞察に富んだ最終レポートを生成します。この分析には以下の特徴があります：

- 全チャンクの結果を考慮した全体像の把握
- 一貫性のある分析結果の提供
- チャンク間の矛盾点や共通点の特定
- ビジネス的観点からの重要な洞察と推奨事項の提示

## APIキーの設定

以下のいずれかの方法でAPIキーを設定できます：

1. サイドバーの「OpenAI APIキー」と「Google Gemini APIキー」入力欄に直接入力
2. `.env`ファイルをプロジェクトのルートディレクトリに作成し、以下のフォーマットで保存:
   ```
   OPENAI_API_KEY=your-openai-api-key-here
   GEMINI_API_KEY=your-gemini-api-key-here
   ```

アプリケーションからも「APIキーの設定について」セクションから`.env`ファイルを簡単に作成できます。

## 技術仕様

- Python 3.7以上
- Streamlit 1.32.0
- pandas 2.2.0
- numpy 1.26.3
- python-dotenv 1.0.0
- aiohttp 3.9.1
- OpenAI API (GPT-4o-mini)
- Google Generative AI (Gemini-1.5-flash) 